compilers:
  regular:
    c:       gcc
    c++:     g++
    fortran: gfortran
  mpi:
    c:       mpicc
    c++:     mpicxx
    fortran: mpif90
  configurations:
  - name: release
    flags:
      c:       -O3
      c++:     -O3
      fortran: -O3 -cpp -c -w -Ofast
  - name: debug
    flags:
      c:       -Og -g
      c++:     -Og -g
      fortran: -Og -g -cpp -c -w -Ofast
  - name: ci
    flags:
      fortran: -cpp -c -w -Ofast
targets:
- name: FFTW3
  type: download
  download:
    version: 3.3.10
    link:    http://www.fftw.org/fftw-${version}.tar.gz
  build:
  - ./configure ${CONFIGURE_OPTIONS} ${MPI_COMPILERS} --enable-threads --enable-mpi
  - make ${MAKE_OPTIONS} ${COMPILER_FLAGS} ${MPI_COMPILERS}
  - make install
- name: HDF5
  type: clone
  clone:
    git:  https://github.com/HDFGroup/hdf5
    hash: 4aa40365623cf35643b262781f92578220c42bbb
  build:
  - ./configure ${CONFIGURE_OPTIONS} ${MPI_COMPILERS} --enable-parallel --enable-deprecated-symbols
  - make ${MAKE_OPTIONS} ${COMPILER_FLAGS} ${MPI_COMPILERS}
  - make install prefix="${INSTALL_PATH}"
- name: SILO
  type: clone
  depends:
  - HDF5
  clone:
    git:  https://github.com/LLNL/Silo
    hash: 9e3a31fbf661c4d26e9f5272287e5ff41971d117
  build:
  - >-
    ./configure ${CONFIGURE_OPTIONS} --enable-pythonmodule --enable-optimization
    --disable-hzip --disable-fpzip --disable-silex
    --with-hdf5="${HDF5:INSTALL_PATH}/include","${HDF5:INSTALL_PATH}/lib"
    ${MPI_COMPILERS}
  - >-
    make ${MAKE_OPTIONS} ${COMPILER_FLAGS} ${MPI_COMPILERS}
    CFLAGS="-O0" CPPFLAGS="-O0" FFLAGS="-O0"
  - make install prefix="${INSTALL_PATH}"
- name: MFC_PreProcess
  type: source
  depends: []
  source:
    source: ${MFC_ROOT_PATH}/src/pre_process_code
  build:
  - make ${MAKE_OPTIONS} ${COMPILER_FLAGS} ${MPI_COMPILERS}
- name: MFC_Simulation
  type: source
  depends:
  - FFTW3
  source:
    source: ${MFC_ROOT_PATH}/src/simulation_code
  build:
  - >-
    make ${MAKE_OPTIONS} ${COMPILER_FLAGS} ${MPI_COMPILERS}
    FFLAGS="-lfftw3 -lm -I${FFTW3:INSTALL_PATH}/include -L${FFTW3:INSTALL_PATH}/lib"
- name: MFC_PostProcess
  type: source
  depends:
  - HDF5
  - SILO
  source:
    source:  ${MFC_ROOT_PATH}/src/post_process_code
  build:
  - make ${MAKE_OPTIONS} ${COMPILER_FLAGS} ${MPI_COMPILERS}
- name: MFC
  type: source
  depends:
  - MFC_PreProcess
  - MFC_Simulation
  - MFC_PostProcess
  source:
    source: ${MFC_ROOT_PATH}
  build: []
